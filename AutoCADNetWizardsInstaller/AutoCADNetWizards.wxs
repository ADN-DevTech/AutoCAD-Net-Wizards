<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

	<?define RTMProductVersion = "18.0.0"?> <!-- The first one - do not edit -->
	<?define ProductVersion = "20.0.0"?>
	<?define UpgradeCode = "{6894135C-6FF7-48CD-B4B1-4C084B67FE7C}"?>
	
	<Product 
		Id="*" 
		Codepage="1252" 
		Language="1033" 
		Manufacturer="Autodesk" 
		Name="AutoCAD 2020 .NET Wizards" 
		UpgradeCode="$(var.UpgradeCode)" 
		Version="$(var.ProductVersion)"
	>
	<Package 
		Id='*'
		Comments="Autodesk Developer Network" 
		Compressed="yes"
		InstallPrivileges="elevated" 			
		InstallerVersion="300" 
		Languages="1033" 
		Manufacturer="by Cyrille Fauvel,Madhukar Moogala" 
		Platform="x86"
	/>

	<Media Id="1" Cabinet="AutoCADNetWizards.cab" EmbedCab="yes" CompressionLevel="high" VolumeLabel="DISK #1'" />
	<Icon Id="AutoCADNetWizards.ico" SourceFile="Binary\__TemplateIcon.ico" />
	
	<?include directory.wxi ?>
	<?include feature.wxi ?>
	<?include property.wxi ?>
	<?include UI.wxi ?>
  <?define NetFx47MinRelease = 460798 ?>

<!--Until support comes from the extension
i.e. <PropertyRef Id="WIX_IS_NETFRAMEWORK_47_OR_LATER_INSTALLED" />-->

    <Condition Message="[ProductName] Requires .NET Framework 4.7 or later to be installed">
      <!--<![CDATA[NETFW47="#460798" OR NETFW47="#460805" OR NETFW47="#461308" OR NETFW47="#461310"]]>-->
      <![CDATA[NETFW47 >="#$(var.NetFx47MinRelease)"]]>
    </Condition>
    
	<Condition Message="Microsoft Visual Studio Pro/Premium/Ultimate 2017 or Visual Community Edition 2017 must be present on the target machine.">
    <![CDATA[VS2017_PRO_VC]]>
	</Condition>

	<InstallUISequence> <!-- msiexec /i -->
		<Custom Action="CA_TARGETDIR" After="AppSearch"><![CDATA[TARGETDIR=""]]></Custom>
		<Show Dialog="WelcomeForm" Before="CostFinalize"><![CDATA[Installed="" AND NOT RESUME]]></Show>
		<Show Dialog="ResumeForm" Before="CostFinalize"><![CDATA[Installed="" AND RESUME]]></Show>
		<Show Dialog="MaintenanceForm" Before="CostFinalize"><![CDATA[Installed<>""]]></Show>
		<Show Dialog="ProgressForm" Before="ExecuteAction" />
		
		<Show Dialog="FatalErrorForm" OnExit="error"><![CDATA[NOT HideFatalErrorForm]]></Show>
		<Show Dialog="UserExitForm" OnExit="cancel" />
		<Show Dialog="FinishedForm" OnExit="success" />
		<Custom Action="PreventDowngrading" After="FindRelatedProducts"><![CDATA[NEWERPRODUCTFOUND]]></Custom>
	</InstallUISequence>
	<InstallExecuteSequence>
		<Custom Action="CA_TARGETDIR" Before="CostInitialize"><![CDATA[TARGETDIR=""]]></Custom>		
		<Custom Action="PreventDowngrading" After="FindRelatedProducts"><![CDATA[NEWERPRODUCTFOUND]]></Custom>
		<RemoveExistingProducts Before="InstallInitialize" /> 
	</InstallExecuteSequence>
	
	<CustomAction Id="CA_AdminUISequence" Property="InAdminUISequence" Value="1" Execute="firstSequence" />
	<AdminUISequence> <!-- msiexec /a (or ACTION=ADMIN) + full UI or reduced UI -->
		<Custom Action="CA_TARGETDIR" Before="CostInitialize"><![CDATA[TARGETDIR=""]]></Custom>
		<Custom Action="CA_AdminUISequence" Before="CostInitialize"></Custom>
		<Show Dialog="WelcomeForm" Before="CostFinalize"><![CDATA[Installed="" AND NOT RESUME]]></Show>
		<Show Dialog="ResumeForm" Before="CostFinalize"><![CDATA[Installed="" AND RESUME]]></Show>
		<Show Dialog="ProgressForm" Before="ExecuteAction" />
		
		<Show Dialog="FatalErrorForm" OnExit="error"><![CDATA[NOT HideFatalErrorForm]]></Show>
		<Show Dialog="UserExitForm" OnExit="cancel" />
		<Show Dialog="AdminFinishedForm" OnExit="success" />
	</AdminUISequence>
	<AdminExecuteSequence>
		<Custom Action="CA_TARGETDIR" Before="CostInitialize"><![CDATA[TARGETDIR=""]]></Custom>
	</AdminExecuteSequence>
	
	<AdvertiseExecuteSequence> <!-- msiexec /j (or ACTION=ADVERTISE) -->
	</AdvertiseExecuteSequence>
	<!--AdvtExecuteSequence>
	</AdvtExecuteSequence-->

	<CustomAction Id="PreventDowngrading" Error="Newer version already installed." /> <!-- Prevent downgrading -->
	<Upgrade Id="$(var.UpgradeCode)">
		<UpgradeVersion Minimum="$(var.ProductVersion)" IncludeMinimum="no" OnlyDetect="yes" Property="NEWERPRODUCTFOUND" />
		<UpgradeVersion Minimum="$(var.RTMProductVersion)" IncludeMinimum="yes" Maximum="$(var.ProductVersion)" IncludeMaximum="no" OnlyDetect="no" Property="UPGRADEFOUND" />
		<!-- Detect for changes in 4th field only -->
		<!-- UpgradeVersion Minimum="$(var.version)" IncludeMinimum="yes" Maximum="$(var.version)" IncludeMaximum="yes" OnlyDetect="yes" Property="ANOTHERBUILDINSTALLED" / -->
	</Upgrade>

	</Product>
</Wix>